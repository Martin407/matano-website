"use strict";(self.webpackChunk_matano_website=self.webpackChunk_matano_website||[]).push([[2510],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>d});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),s=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},m=function(e){var t=s(e.components);return r.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,c=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),p=s(n),d=o,h=p["".concat(c,".").concat(d)]||p[d]||u[d]||i;return n?r.createElement(h,a(a({ref:t},m),{},{components:n})):r.createElement(h,a({ref:t},m))}));function d(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=p;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:o,a[1]=l;for(var s=2;s<i;s++)a[s]=n[s];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},7759:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>s});var r=n(7462),o=(n(7294),n(3905));const i={title:"Using enrichment tables in detections",sidebar_label:"Using enrichment tables",sidebar_position:4},a=void 0,l={unversionedId:"detections/enrichment",id:"detections/enrichment",title:"Using enrichment tables in detections",description:"You can use enrichment tables to enrich your alerts and detection logic inside Python detections.",source:"@site/docs/detections/enrichment.md",sourceDirName:"detections",slug:"/detections/enrichment",permalink:"/docs/detections/enrichment",draft:!1,editUrl:"https://github.com/matanolabs/matano-website/tree/main/website/docs/detections/enrichment.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"Using enrichment tables in detections",sidebar_label:"Using enrichment tables",sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Remote cache",permalink:"/docs/detections/remote-cache"},next:{title:"Realtime alerting",permalink:"/docs/detections/alerting/"}},c={},s=[{value:"Access enrichment tables in detections",id:"access-enrichment-tables-in-detections",level:3},{value:"Lookup enrichment table data",id:"lookup-enrichment-table-data",level:2},{value:"Enrichment tables with multiple lookup keys",id:"enrichment-tables-with-multiple-lookup-keys",level:3}],m={toc:s};function u(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"You can use ",(0,o.kt)("a",{parentName:"p",href:"/docs/enrichment/overview"},"enrichment tables")," to enrich your alerts and detection logic inside Python detections."),(0,o.kt)("p",null,"For information on creating and working with enrichment tables, see ",(0,o.kt)("a",{parentName:"p",href:"/docs/enrichment/working-with-enrichment-tables"},(0,o.kt)("em",{parentName:"a"},"Working with enrichment tables")),"."),(0,o.kt)("h3",{id:"access-enrichment-tables-in-detections"},"Access enrichment tables in detections"),(0,o.kt)("p",null,"To access an enrichment table inside a Python detection, you can simply import the enrichment table by name inside your Python program. For example, if we have an enrichment table named ",(0,o.kt)("inlineCode",{parentName:"p"},"user_info"),", we can add the following code to our detection script to access the enrichment table:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"# detect.py\n\nfrom matano.enrichment import user_info\n\ndef detect(e):\n    ...\n")),(0,o.kt)("p",null,"The import statement in the first line imports our enrichment table. We can also import multiple enrichment tables using regular Python syntax:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"# detect.py\n\nfrom matano.enrichment import user_info, host_info\n\ndef detect(e):\n    ...\n")),(0,o.kt)("h2",{id:"lookup-enrichment-table-data"},"Lookup enrichment table data"),(0,o.kt)("p",null,"Enrichment tables allow you to lookup data based on a key you specify. For more on configuring enrichment lookups, see ",(0,o.kt)("a",{parentName:"p",href:"/docs/enrichment/lookup-data"},(0,o.kt)("em",{parentName:"a"},"Lookup enrichment data")),"."),(0,o.kt)("p",null,"To lookup data by a key in your detection script, you can use the ",(0,o.kt)("inlineCode",{parentName:"p"},".get")," method on the enrichment table object. For example, to lookup a user from a ",(0,o.kt)("inlineCode",{parentName:"p"},"user_info")," enrichment table by the ",(0,o.kt)("inlineCode",{parentName:"p"},"user_id")," key we can call the ",(0,o.kt)("inlineCode",{parentName:"p"},".get")," method with the value of the lookup key:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'# detect.py\n\nfrom matano.enrichment import user_info\n\ndef detect(e):\n    user_id = e.deepget("user.id")\n    info = user_info.get(user_id)\n    ...\n')),(0,o.kt)("p",null,"The method will return ",(0,o.kt)("inlineCode",{parentName:"p"},"None")," in the case that the key does not exist in the enrichment table."),(0,o.kt)("h3",{id:"enrichment-tables-with-multiple-lookup-keys"},"Enrichment tables with multiple lookup keys"),(0,o.kt)("p",null,"By default, if you have one lookup key defined for your enrichment table, you can simply call the ",(0,o.kt)("inlineCode",{parentName:"p"},".get")," method with the value of the single lookup key. If you have configured your table with multiple lookup keys, you must disambiguate the lookup key you want to use by providing a second argument to the ",(0,o.kt)("inlineCode",{parentName:"p"},".get")," method with the name of the lookup key to use."),(0,o.kt)("p",null,"For example, if we have an enrichment table with two lookup keys as so:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yml"},'# enrichment/user_info/enrichment.yml\n\nname: user_info\nlookup_keys: ["user_id", "email"]\n')),(0,o.kt)("p",null,"We can then use this enrichment table in our detection as follows:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'# detect.py\n\nfrom matano.enrichment import user_info\n\ndef detect(e):\n    user_id = e.deepget("user.id")\n    info = user_info.get(user_id, "user_id")\n\n    email = e.deepget("email")\n    info = user_info.get(user_id, "email")\n    ...\n')),(0,o.kt)("p",null,"We can then either lookup our user information by user ID or email address."))}u.isMDXComponent=!0}}]);